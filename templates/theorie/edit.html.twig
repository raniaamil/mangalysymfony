{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-5">
    <h1>Modifier la théorie</h1>
    <form method="post" enctype="multipart/form-data" class="mt-4">
        <div class="form-group">
            <label for="titre">Titre</label>
            <input type="text" id="titre" name="titre" class="form-control" value="{{ theorie.titre }}" required>
        </div>
        <div class="form-group mt-3">
            <label for="contenu">Contenu</label>
            <textarea id="contenu" name="contenu" class="form-control" rows="5" required>{{ theorie.contenu }}</textarea>
        </div>
        <div class="form-group mt-3">
            <label for="manga">Manga</label>
            <input type="text" id="manga" name="manga" class="form-control" value="{{ theorie.manga.titre }}" required autocomplete="off" 
                   data-autocomplete-url="{{ path('manga_suggestions') }}">
        </div>
        <div class="form-group mt-3">
            <label for="media">Média (image, vidéo ou fichier audio)</label>
            <input type="file" id="media" name="media" class="form-control" accept="image/*,video/*,audio/*">
        </div>
        {% if theorie.media %}
            <div class="mt-3">
                <p>Type : {{ theorie.mediaType }}</p>
                {% if theorie.mediaType == 'image' %}
                    <img src="{{ asset('uploads/' ~ theorie.media) }}" alt="Media" class="img-fluid">
                {% elseif theorie.mediaType == 'video' %}
                    <video controls class="w-100">
                        <source src="{{ asset('uploads/' ~ theorie.media) }}" type="video/mp4">
                    </video>
                {% elseif theorie.mediaType == 'audio' %}
                    <audio controls>
                        <source src="{{ asset('uploads/' ~ theorie.media) }}" type="audio/mpeg">
                    </audio>
                {% endif %}
            </div>
        {% else %}
            <p>Aucun média associé</p>
        {% endif %}
        <button type="submit" class="btn btn-primary mt-3">Enregistrer</button>
        <a href="{{ path('theorie_index') }}" class="btn btn-secondary mt-3">Retour</a>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mangaInput = document.getElementById('manga');
        const suggestionsBox = document.getElementById('manga-suggestions');

        mangaInput.addEventListener('input', function () {
            const query = this.value;

            if (query.length > 1) {
                fetch('/manga/suggestions?q=' + query)
                    .then(response => response.json())
                    .then(data => {
                        suggestionsBox.innerHTML = '';
                        data.forEach(manga => {
                            const item = document.createElement('div');
                            item.classList.add('list-group-item');
                            item.textContent = manga.titre;
                            item.addEventListener('click', function () {
                                mangaInput.value = manga.titre;
                                suggestionsBox.innerHTML = '';
                            });
                            suggestionsBox.appendChild(item);
                        });
                    });
            } else {
                suggestionsBox.innerHTML = '';
            }
        });
    });
</script>
{% endblock %}
