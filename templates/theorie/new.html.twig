{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-5">
    <h1>Ajouter une théorie</h1>
    <form method="post" enctype="multipart/form-data" class="mt-4">
        <div class="form-group">
            <label for="titre">Titre</label>
            <input type="text" id="titre" name="titre" class="form-control" required>
        </div>
        <div class="form-group mt-3">
            <label for="contenu">Contenu</label>
            <textarea id="contenu" name="contenu" class="form-control" rows="5" required></textarea>
        </div>
        <div class="form-group mt-3">
            <label for="manga">Manga</label>
            <input type="text" id="manga" name="manga" class="form-control" autocomplete="off" required>
            <div id="manga-suggestions" class="list-group"></div>
        </div>
        <div class="form-group mt-3">
            <label for="media">Média (image, vidéo ou fichier audio)</label>
            <input type="file" id="media" name="media" class="form-control" accept="image/*,video/*,audio/*">
            <small class="form-text text-muted">Formats acceptés : image, vidéo ou fichier audio.</small>
        </div>
        <button type="submit" class="btn btn-success mt-3">Enregistrer</button>
        <a href="{{ path('theorie_index') }}" class="btn btn-secondary mt-3">Retour</a>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mangaInput = document.getElementById('manga');
        const suggestionsBox = document.getElementById('manga-suggestions');

        mangaInput.addEventListener('input', function () {
            const query = this.value;

            if (query.length > 1) {
                fetch('/manga/suggestions?q=' + query)
                    .then(response => response.json())
                    .then(data => {
                        suggestionsBox.innerHTML = '';
                        data.forEach(manga => {
                            const item = document.createElement('div');
                            item.classList.add('list-group-item');
                            item.textContent = manga.titre;
                            item.addEventListener('click', function () {
                                mangaInput.value = manga.titre;
                                suggestionsBox.innerHTML = '';
                            });
                            suggestionsBox.appendChild(item);
                        });
                    });
            } else {
                suggestionsBox.innerHTML = '';
            }
        });
    });
</script>
{% endblock %}
